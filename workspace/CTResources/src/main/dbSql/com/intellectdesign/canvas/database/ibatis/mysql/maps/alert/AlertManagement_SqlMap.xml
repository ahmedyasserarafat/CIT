<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>

	<resultMap id="ALERT_DATA_KEY_MAP" class="java.util.HashMap"
		groupBy="ALERT_ID">
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="DATA_KEY_LIST" javaType="java.util.List"
			resultMap="DATA_KEYS_FOR_ALERT" />
	</resultMap>

	<resultMap id="DATA_KEYS_FOR_ALERT" class="java.util.HashMap">
		<result property="DATA_KEY" nullValue="" column="DATA_KEY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DATA_DESCRIPTION" nullValue=""
			column="DATA_DESCRIPTION" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DATA_TYPE" nullValue="" column="DATA_TYPE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="INTERPRET_AS_KEY_FLAG" nullValue=""
			column="INTERPRET_AS_KEY_FLAG" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="RESOURCE_BUNDLE_NAME" nullValue=""
			column="RESOURCE_BUNDLE_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_ALERT_DATA_KEYS"
		parameterClass="java.util.HashMap" resultMap="ALERT_DATA_KEY_MAP">
		SELECT
		AD.ALERT_ID ALERT_ID,
		AD.DATA_KEY DATA_KEY,
		ADM.DATA_DESCRIPTION DATA_DESCRIPTION,
		ADM.DATA_TYPE DATA_TYPE,
		ADM.INTERPRET_AS_KEY_FLAG
		INTERPRET_AS_KEY_FLAG,
		ADM.RESOURCE_BUNDLE_NAME RESOURCE_BUNDLE_NAME
		FROM
		ALERT_DATA_MASTER ADM,
		ALERT_DATA AD
		WHERE
		ADM.DATA_KEY = AD.DATA_KEY
	</select>



	<!-- ResultMap for fetching alert details for a particular event id . DataSource 
		is added -->
	<resultMap id="ALERT_DETAIL_MAP" class="java.util.HashMap"
		groupBy="ALERT_ID">
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="ALERT_DESCRIPTION" nullValue=""
			column="ALERT_DESCRIPTION" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SEVERITY" nullValue="" column="SEVERITY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DATA_SOURCE" nullValue="" column="DATA_SOURCE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENTL_TYPE" nullValue="" column="ENTL_TYPE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<!-- Query for getting the Alert details for a particular Event Id -->
	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALERT_DTLS"
		parameterClass="java.util.HashMap" resultMap="ALERT_DETAIL_MAP">
		SELECT
		ALERT_ID,
		ALERT_DESCRIPTION,
		SEVERITY,
		DATA_SOURCE,
		ENTL_TYPE
		FROM
		ALERT_MASTER
		WHERE
		EVENT_ID =#EVENT_ID#
	</select>

	<resultMap id="ALL_MESSAGES_DTLS_MAP" class="java.util.HashMap">
		<result property="MESSAGE_ID" nullValue="" column="MESSAGE_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="FROM_USER_ID" nullValue="" column="FROM_USER_ID"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SHORT_MESSAGE" nullValue="" column="SHORT_MESSAGE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DETAILED_MESSAGE" nullValue=""
			column="DETAILED_MESSAGE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DRAFT_INDICATOR" nullValue="" column="DRAFT_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="STR_MESSAGE_TS" nullValue="" column="STR_MESSAGE_TS"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="STR_MESSAGE_DURATION" nullValue=""
			column="STR_MESSAGE_DURATION" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="FORMATTED_MSG_FLAG" nullValue=""
			column="FORMATTED_MSG_FLAG" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ARCHIVED_INDICATOR" nullValue=""
			column="ARCHIVED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="READ_INDICATOR" nullValue="" column="READ_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="DELETED" nullValue="" column="DELETED"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ACTIONED_INDICATOR" nullValue=""
			column="ACTIONED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="SEVERITY" nullValue="" column="SEVERITY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="IS_NOTIFICATION" nullValue="" column="IS_NOTIFICATION"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="PRODUCT_CODE" nullValue="" column="PRODUCT_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE" nullValue=""
			column="SUB_PRODUCT_CODE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE_DISPVAL" nullValue=""
			column="SUB_PRODUCT_CODE_DISPVAL" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="FUNCTION_CODE" nullValue="" column="FUNCTION_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_CCY" nullValue="" column="ENRICH_CCY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BANK_NAME" nullValue=""
			column="ENRICH_BANK_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BRANCH_NAME" nullValue=""
			column="ENRICH_BRANCH_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_COUNTRY_NAME" nullValue=""
			column="ENRICH_COUNTRY_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_SUBPROD_DESC" nullValue=""
			column="ENRICH_SUBPROD_DESC" javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<!-- Query for getting all messages for a particular user id -->
	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGE_DTLS"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'

		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<!-- ResultMap for getting the message details -->
	<resultMap id="UNREAD_MESSAGES_DTLS_MAP" class="java.util.HashMap">
		<result property="MESSAGE_ID" nullValue="" column="MESSAGE_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="FROM_USER_ID" nullValue="" column="FROM_USER_ID"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SHORT_MESSAGE" nullValue="" column="SHORT_MESSAGE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DETAILED_MESSAGE" nullValue=""
			column="DETAILED_MESSAGE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DRAFT_INDICATOR" nullValue="" column="DRAFT_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="STR_MESSAGE_TS" nullValue="" column="STR_MESSAGE_TS"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="STR_MESSAGE_DURATION" nullValue=""
			column="STR_MESSAGE_DURATION" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="FORMATTED_MSG_FLAG" nullValue=""
			column="FORMATTED_MSG_FLAG" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ARCHIVED_INDICATOR" nullValue=""
			column="ARCHIVED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="READ_INDICATOR" nullValue="" column="READ_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="DELETED" nullValue="" column="DELETED"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ACTIONED_INDICATOR" nullValue=""
			column="ACTIONED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="SEVERITY" nullValue="" column="SEVERITY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="PRODUCT_CODE" nullValue="" column="PRODUCT_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE" nullValue=""
			column="SUB_PRODUCT_CODE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE_DISPVAL" nullValue=""
			column="SUB_PRODUCT_CODE_DISPVAL" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="FUNCTION_CODE" nullValue="" column="FUNCTION_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_CCY" nullValue="" column="ENRICH_CCY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BANK_NAME" nullValue=""
			column="ENRICH_BANK_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BRANCH_NAME" nullValue=""
			column="ENRICH_BRANCH_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_COUNTRY_NAME" nullValue=""
			column="ENRICH_COUNTRY_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_SUBPROD_DESC" nullValue=""
			column="ENRICH_SUBPROD_DESC" javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<!-- Query for getting unread messages for a particular user id -->
	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_UNREAD_MESSAGE_DTLS"
		parameterClass="java.util.HashMap" resultMap="UNREAD_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		NOW()-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		EMSTR.PRODUCT_CODE
		PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE FUNCTION_CODE,
		LKV.LOCALE_VALUE
		SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY ENRICH_CCY,
		MSG.PROD_NAME
		ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME
		ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		UMSG.READ_INDICATOR = #READ_INDICATOR#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_STATUS"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
	SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		NOW()-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		EMSTR.PRODUCT_CODE
		PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE FUNCTION_CODE,
		LKV.LOCALE_VALUE
		SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY ENRICH_CCY,
		MSG.PROD_NAME
		ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME
		ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		
	EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		UMSG.READ_INDICATOR = #READ_INDICATOR#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		
		<include refid="DEFAULT_ORDERBY_CLAUSE" />

	</select>

	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_SEVERITY"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		AMSTR.SEVERITY = #SEVERITY#
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_GT"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		NOW()-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
	EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		UMSG.MESSAGE_TS &gt; STR_TO_DATE(#DATE1#, '%d/%m/yyyy')
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<!-- Query for getting messages for the date less than the given date -->
	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_LT"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
	SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		UMSG.MESSAGE_TS &lt; (STR_TO_DATE(#DATE1#,'%d/%m/yyyy')+1)
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>


	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_ET"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
	SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		truncate(UMSG.MESSAGE_TS, 0) = STR_TO_DATE(#DATE1#, '%d/%m/yyyy')
	
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
		<!-- ORDER BY UMSG.MESSAGE_TS DESC -->
	</select>

	<!-- Query for getting messages for the date greater than or equals to the 
		given date -->
	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_GTOET"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		truncate(UMSG.MESSAGE_TS, 0) &gt;= STR_TO_DATE(#DATE1#, '%d/%m/yyyy')

		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<!-- Query for getting messages for the date less than or equal to the given 
		date -->
	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_LTOET"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#

		AND
		truncate(UMSG.MESSAGE_TS, 0) &lt;= (STR_TO_DATE(#DATE1#, '%d/%m/yyyy')+1)

		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<!-- Query for getting messages for the date not equal to the given date -->
	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_NET"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
	SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		truncate(UMSG.MESSAGE_TS, 0) &gt;&lt; STR_TO_DATE(#DATE1#, '%d/%m/yyyy')
		
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>
	<!-- Query for getting messages within the given range of date -->
	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MESSAGES_FOR_DATE_RANGE"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
	EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
	
		UMSG.MESSAGE_TS BETWEEN str_to_date(#DATE1#, '%d/%m/yyyy hh24:mi:ss') and
		str_to_date(#DATE2#, '%d/%m/yyyy hh24:mi:ss')
		<!-- trunc(UMSG.MESSAGE_TS) BETWEEN TO_DATE(#DATE1#, 'dd/MM/yyyy') AND 
			(TO_DATE(#DATE2#, 'dd/MM/yyyy')+1) -->
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_MESSAGES_UNREAD_COUNT"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
	SELECT
		count(*) total_count
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR
		WHERE

		<!-- UMSG.MESSAGE_TS BETWEEN SYSDATE-7 AND SYSDATE AND -->
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		UMSG.READ_INDICATOR = 'N'
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
	</select>


	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_MESSAGES_COUNT"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
	SELECT
		count(*) total_count
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR
		WHERE

		<!-- UMSG.MESSAGE_TS BETWEEN SYSDATE-7 AND SYSDATE AND -->
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
	</select>





	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_UNREAD_SEVERITY_MESSAGE_DTLS"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		<include refid="PAGINATION_BEGINS" />
SELECT
		count(*) total_count
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR
		WHERE

		<!-- UMSG.MESSAGE_TS BETWEEN SYSDATE-7 AND SYSDATE AND -->
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND (SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
		EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		AMSTR.SEVERITY = #SEVERITY#
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.READ_INDICATOR = 'N'
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#)
		<include refid="DEFAULT_ORDERBY_CLAUSE" />
		<include refid="PAGINATION_ENDS" />
	</select>

	<update id="ALERT_FRMWRK_MNT_UPDATE_UPDATE_MAIL_STATUS_AS_READ"
		parameterClass="java.util.HashMap">
	UPDATE
		OD_USER_MESSAGE
		SET
		DELETED='Y'
		WHERE
		TO_USER_ID=#USER_ID#
		AND
		GCIF = #GCIF#
		AND
		MESSAGE_ID IN

	</update>

	<!-- This query is used to update the deleted indicator status for the given 
		message ids -->
	<update id="ALERT_FRMWRK_MNT_UPDATE_ALERT_EXT_MARK_MSGS_AS_DELETED"
		parameterClass="java.util.HashMap">
		UPDATE
		OD_USER_MESSAGE
		SET
		DELETED='Y'
		WHERE
		TO_USER_ID=#USER_ID#
		AND
		GCIF = #GCIF#
		AND
		MESSAGE_ID IN
		<iterate property="MESSAGE_ID" open="(" close=")" conjunction=",">
			#MESSAGE_ID[]#
		</iterate>
	</update>

	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_UNREAD_MESSAGES_FOR_STATUS"
		parameterClass="java.util.HashMap" resultMap="ALL_MESSAGES_DTLS_MAP">
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.MESSAGE_ID MESSAGE_ID,
		UMSG.ACTIONED_INDICATOR
		ACTIONED_INDICATOR,
		AMSTR.SEVERITY SEVERITY,
		AMSTR.IS_NOTIFICATION
		IS_NOTIFICATION,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE
		FUNCTION_CODE,
		LKV.LOCALE_VALUE SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY
		ENRICH_CCY,
		MSG.PROD_NAME ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME
		ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME ENRICH_BRANCH_NAME
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
	EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		(UMSG.TO_USER_ID =#USER_ID# OR UMSG.TO_USER_ID='ALL_USERS')
		AND
		UMSG.GCIF = #GCIF#
		AND
		MSG.MESSAGE_ID = UMSG.MESSAGE_ID
		AND
		UMSG.READ_INDICATOR= #READ_INDICATOR#
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		AND
		UMSG.ACTIONED_INDICATOR = #ACTIONED_INDICATOR#
		AND
		AMSTR.IS_NOTIFICATION=#IS_NOTIFICATION#
		<include refid="DEFAULT_ORDERBY_CLAUSE" />

	</select>



	<resultMap id="MESSAGE_DTLS_MAP" class="java.util.HashMap">
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="FROM_USER_ID" nullValue="" column="FROM_USER_ID"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SHORT_MESSAGE" nullValue="" column="SHORT_MESSAGE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DETAILED_MESSAGE" nullValue=""
			column="DETAILED_MESSAGE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="DRAFT_INDICATOR" nullValue="" column="DRAFT_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="STR_MESSAGE_TS" nullValue="" column="STR_MESSAGE_TS"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="STR_MESSAGE_DURATION" nullValue=""
			column="STR_MESSAGE_DURATION" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="FORMATTED_MSG_FLAG" nullValue=""
			column="FORMATTED_MSG_FLAG" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ARCHIVED_INDICATOR" nullValue=""
			column="ARCHIVED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="READ_INDICATOR" nullValue="" column="READ_INDICATOR"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="DELETED" nullValue="" column="DELETED"
			javaType="java.lang.String" jdbcType="CHAR" />
		<result property="ACTIONED_INDICATOR" nullValue=""
			column="ACTIONED_INDICATOR" javaType="java.lang.String" jdbcType="CHAR" />
		<result property="SEVERITY" nullValue="" column="SEVERITY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="PRODUCT_CODE" nullValue="" column="PRODUCT_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE" nullValue=""
			column="SUB_PRODUCT_CODE" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="SUB_PRODUCT_CODE_DISPVAL" nullValue=""
			column="SUB_PRODUCT_CODE_DISPVAL" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="FUNCTION_CODE" nullValue="" column="FUNCTION_CODE"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_CCY" nullValue="" column="ENRICH_CCY"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BANK_NAME" nullValue=""
			column="ENRICH_BANK_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_BRANCH_NAME" nullValue=""
			column="ENRICH_BRANCH_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_COUNTRY_NAME" nullValue=""
			column="ENRICH_COUNTRY_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="ENRICH_SUBPROD_DESC" nullValue=""
			column="ENRICH_SUBPROD_DESC" javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="HAS_ATTACHMENT" nullValue="" column="HAS_ATTACHMENT"
			javaType="java.lang.String" jdbcType="VARCHAR2" />

	</resultMap>



	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_MESSAGE_DTLS"
		parameterClass="java.util.HashMap" resultMap="MESSAGE_DTLS_MAP">
		SELECT
		MSG.ALERT_ID ALERT_ID,
		MSG.FROM_USER_ID FROM_USER_ID,
		MSG.SHORT_MESSAGE
		SHORT_MESSAGE,
		MSG.DETAILED_MESSAGE DETAILED_MESSAGE,
		MSG.DRAFT_INDICATOR DRAFT_INDICATOR,
		DATE_FORMAT(UMSG.MESSAGE_TS,
		
		'%d/%m/%Y %H:%i:%s') STR_MESSAGE_TS,
		DAY(
		current_timestamp-UMSG.MESSAGE_TS) STR_MESSAGE_DURATION,
		MSG.FORMATTED_MSG_FLAG FORMATTED_MSG_FLAG,
		UMSG.ARCHIVED_INDICATOR
		ARCHIVED_INDICATOR,
		UMSG.READ_INDICATOR READ_INDICATOR,
		UMSG.DELETED
		DELETED,
		UMSG.ACTIONED_INDICATOR ACTIONED_INDICATOR,
		AMSTR.SEVERITY
		SEVERITY,
		EMSTR.PRODUCT_CODE PRODUCT_CODE,
		EMSTR.SUB_PRODUCT_CODE
		SUB_PRODUCT_CODE,
		EMSTR.FUNCTION_CODE FUNCTION_CODE,
		LKV.LOCALE_VALUE
		SUB_PRODUCT_CODE_DISPVAL,
		MSG.PROD_CCY ENRICH_CCY,
		MSG.PROD_NAME
		ENRICH_SUBPROD_DESC,
		MSG.PROD_CTRY_NAME ENRICH_COUNTRY_NAME,
		MSG.PROD_BANK_NAME ENRICH_BANK_NAME,
		MSG.PROD_BRANCH_NAME
		ENRICH_BRANCH_NAME,
		AMSTR.HAS_ATTACHMENT
		FROM
		OD_MESSAGE MSG,
		OD_USER_MESSAGE UMSG,
		ALERT_MASTER AMSTR,
	EVENT_MASTER EMSTR left join LOCALE_KEY_VALUE LKV  ON (EMSTR.FUNCTION_CODE=LKV.LOCALE_KEY AND
		LKV.LANG_ID=#LANG_ID# and
		LKV.DEFINITION='PORTAL_FUNCTION_CODE')
		WHERE
		MSG.MESSAGE_ID =#MESSAGE_ID#
		AND
		UMSG.TO_USER_ID =#USER_ID#
		AND
		UMSG.MESSAGE_ID = MSG.MESSAGE_ID
		AND
		AMSTR.ALERT_ID = MSG.ALERT_ID
		AND
		EMSTR.EVENT_ID = AMSTR.EVENT_ID
		AND
		UMSG.DELETED = 'N'
		AND
		UMSG.ARCHIVED_INDICATOR = 'N'
		ORDER BY
		UMSG.MESSAGE_TS DESC
	</select>

	<resultMap id="CHANNEL_HANDLER_PRPT_FOR_ALERT" class="java.util.HashMap">
		<result property="CHANNEL_ID" nullValue="" column="CHANNEL_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="CHANNEL_NAME" nullValue="" column="CHANNEL_NAME"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="CHANNEL_HANDLER" nullValue="" column="CHANNEL_HANDLER"
			javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_CHANNEL_HANDLER_DTLS"
		parameterClass="java.util.HashMap" resultMap="CHANNEL_HANDLER_PRPT_FOR_ALERT">
		SELECT
		CHM.CHANNEL_ID CHANNEL_ID,
		CHM.CHANNEL_NAME CHANNEL_NAME,
		CHM.CHANNEL_HANDLER
		CHANNEL_HANDLER
		FROM
		CHANNEL_MASTER CHM,
		OD_ALERT_CHANNEL_DETAILS ACHD
		WHERE
		ACHD.ALERT_ID =#ALERT_ID#
		AND
		CHM.CHANNEL_ID = ACHD.CHANNEL_ID
	</select>


	<resultMap id="ALERT_PRPT_MAP" class="java.util.HashMap"
		groupBy="ALERT_ID">
		<result property="ALERT_ID" nullValue="" column="ALERT_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="CHANNEL_HANDLER_LIST" javaType="java.util.List"
			resultMap="CHANNEL_HANDLER_PRPT_FOR_ALERT" />
	</resultMap>


	<select
		id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_CHANNEL_HANDLER_DTLS"
		parameterClass="java.util.HashMap" resultMap="ALERT_PRPT_MAP">
		SELECT
		ACHD.ALERT_ID ALERT_ID,
		CHM.CHANNEL_ID CHANNEL_ID,
		CHM.CHANNEL_NAME CHANNEL_NAME,
		CHM.CHANNEL_HANDLER CHANNEL_HANDLER
		FROM
		CHANNEL_MASTER CHM,
		OD_ALERT_CHANNEL_DETAILS ACHD
		WHERE
		CHM.CHANNEL_ID = ACHD.CHANNEL_ID
	</select>


	<resultMap id="GET_CHANNEL_HANDLERS_MAP" class="java.util.HashMap">
		<result property="CHANNEL_ID" nullValue="" column="CHANNEL_ID"
			javaType="java.lang.String" jdbcType="VARCHAR2" />
		<result property="CHANNEL_NAME" nullValue="" column="CHANNEL_NAME"
			javaType="java.lang.String" jdbcType="VARCHAR2" />
		<result property="CHANNEL_HANDLER" nullValue="" column="CHANNEL_HANDLER"
			javaType="java.lang.String" jdbcType="VARCHAR2" />
	</resultMap>


	<select id="ALERT_FRMWRK_MNT_SELECT_CHANNEL_HANDLERS" resultMap="GET_CHANNEL_HANDLERS_MAP">
		SELECT
		CHANNEL_ID CHANNEL_ID,
		CHANNEL_NAME CHANNEL_NAME,
		CHANNEL_HANDLER
		FROM CHANNEL_MASTER
	</select>

	<resultMap id="GET_USERS_SUB_FOR_CHANNELS_MAP" class="java.util.HashMap">
		<result property="OD_USER_NO" nullValue="" column="OD_USER_NO"
			javaType="java.lang.String" jdbcType="VARCHAR2" />
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_USERS_SUB_FOR_CHANNELS"
		resultClass="java.lang.String">
		SELECT
		OD_USER_NO
		FROM
		ALERT_SUBSCRIPTION
		WHERE
		ALERT_ID = #ALERT_ID#
		AND
		CHANNEL_ID = #CHANNEL_ID#
		AND
		OD_USER_NO IN
		<iterate property="OD_USER_NO" open="(" close=")" conjunction=",">
			#OD_USER_NO[]#
		</iterate>

	</select>




	<resultMap id="SUBSCRIBED_FOR_ALERTS" class="java.util.HashMap">
		<result property="OD_USER_NO" nullValue="" column="OD_USER_NO"
			javaType="java.lang.String" jdbcType="VARCHAR2" />
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_SUBSCRIBED_FOR_ALERTS"
		resultClass="java.lang.String">
		SELECT
		OD_USER_NO
		FROM
		ALERT_SUBSCRIPTION
		WHERE
		ALERT_ID = #ALERT_ID#
		AND
		OD_USER_NO IN
		<iterate property="OD_USER_NO" open="(" close=")" conjunction=",">
			#OD_USER_NO[]#
		</iterate>

	</select>

	 <resultMap id="GET_USERS_LIST_MAP" class="java.util.HashMap">   
	  <result property="OD_USER_NO" nullValue="" column="OD_USER_NO" javaType="java.lang.String" jdbcType="VARCHAR2"/>  
	 </resultMap>
 
	 <select id="ALERT_FRMWRK_MNT_SELECT_GET_USERS_LIST"  resultClass="java.lang.String">
		 SELECT
		  OD_USER_NO
		 FROM
		  ALERT_SUBSCRIPTION
		 WHERE
		  ALERT_ID = #ALERT_ID#
		  AND
		  OD_USER_NO IN
		    <iterate property="OD_USER_NO" open="(" close=")" conjunction=",">
		     #OD_USER_NO[]#
		    </iterate> 
  
	 </select>
 



	<!-- ResultMap for fetching the formatter details -->
	<resultMap id="FORMATTER_PRPT_MAP" class="java.util.HashMap">
		<result property="CHANNEL_ID" nullValue="" column="CHANNEL_ID"
			javaType="java.lang.String" jdbcType="NUMBER" />
		<result property="CHANNEL_FORMATTER" nullValue=""
			column="CHANNEL_FORMATTER" javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>


	<!-- Query for fetching all the message formatter details -->
	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_ALL_MSG_FORMATTER_DTLS"
		parameterClass="java.util.HashMap" resultMap="FORMATTER_PRPT_MAP">
		SELECT
		CHANNEL_ID,
		CHANNEL_FORMATTER
		FROM
		CHANNEL_MASTER
	</select>

	<!-- Query for fetching the message formatter class name for a particular 
		channel id -->
	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_MSG_FORMATTER_DTLS"
		parameterClass="java.util.HashMap" resultClass="java.lang.String">
		SELECT
		CHANNEL_FORMATTER
		FROM
		CHANNEL_MASTER
		WHERE
		CHANNEL_ID = #CHANNEL_ID#
	</select>

	<!-- Parameter map for inserting details in message inbox table -->
	<parameterMap id="MESSAGE_PARAM_MAP" class="java.util.HashMap">
		<parameter property="MESSAGE_ID" jdbcType="NUMBER" javaType="java.lang.String" />
		<parameter property="ALERT_ID" jdbcType="NUMBER" javaType="java.lang.String" />
		<parameter property="FROM_USER_ID" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="SHORT_MESSAGE" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="DETAILED_MESSAGE" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="DRAFT_INDICATOR" jdbcType="CHAR"
			javaType="java.lang.String" />
		<parameter property="FORMATTED_MSG_FLAG" jdbcType="CHAR"
			javaType="java.lang.String" />
		<parameter property="ENRICH_CCY" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="ENRICH_SUBPROD_DESC" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="ENRICH_COUNTRY_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="ENRICH_BANK_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="ENRICH_BRANCH_NAME" jdbcType="VARCHAR"
			javaType="java.lang.String" />
	</parameterMap>

	<!-- inbox message insertion into master -->
	<insert id="ALERT_FRMWRK_MNT_INSERT_ALERT_EXT_MESSAGE"
		parameterMap="MESSAGE_PARAM_MAP">
		INSERT INTO OD_MESSAGE
		(
		MESSAGE_ID,
		ALERT_ID,
		FROM_USER_ID,
		SHORT_MESSAGE,
		DETAILED_MESSAGE,
		DRAFT_INDICATOR,
		FORMATTED_MSG_FLAG,
		PROD_CCY,
		PROD_NAME,
		PROD_CTRY_NAME,
		PROD_BANK_NAME,
		PROD_BRANCH_NAME
		)
		VALUES
		(
		?,
		?,
		?,
		?,
		?,
		?,
		?,
		?,
		?,
		?,
		?,
		?
		)
	</insert>
	<!-- Parameter map for inserting details in user_message table -->
	<parameterMap id="RECIPIENT_PARAM_MAP" class="java.util.HashMap">
		<parameter property="MESSAGE_ID" jdbcType="NUMBER" javaType="java.lang.String" />
		<parameter property="TO_USER_ID" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<parameter property="GCIF" jdbcType="VARCHAR" javaType="java.lang.String" />
		<parameter property="READ_INDICATOR" jdbcType="CHAR"
			javaType="java.lang.String" />
		<parameter property="DELETED" jdbcType="CHAR" javaType="java.lang.String" />
		<parameter property="ACTIONED_INDICATOR" jdbcType="CHAR"
			javaType="java.lang.String" />
	</parameterMap>

	<!-- inbox recipient insertion into master -->
	<insert id="ALERT_FRMWRK_MNT_INSERT_ALERT_EXT_RECIPIENT"
		parameterMap="RECIPIENT_PARAM_MAP">
		INSERT INTO OD_USER_MESSAGE
		(
		MESSAGE_ID,
		TO_USER_ID,
		GCIF,
		READ_INDICATOR,
		DELETED,
		ACTIONED_INDICATOR,
		MESSAGE_TS,
		ARCHIVED_INDICATOR
		)
		VALUES
		(
		?,
		?,
		?,
		?,
		?,
		?,
		SYSDATE(),
		'N'
		)
	</insert>
	<!-- inbox recipient bulk insertion -->
	<insert id="ALERT_FRMWRK_MNT_BATCH_INSERT_ALERT_EXT_RECIPIENT"
		parameterMap="RECIPIENT_PARAM_MAP">
		INSERT INTO OD_USER_MESSAGE
		(
		MESSAGE_ID,
		TO_USER_ID,
		GCIF,
		READ_INDICATOR,
		DELETED,
		ACTIONED_INDICATOR,
		MESSAGE_TS,
		ARCHIVED_INDICATOR
		)
		VALUES
		(
		?,
		?,
		?,
		?,
		?,
		?,
		SYSDATE(),
		'N'
		)
	</insert>

	<resultMap id="INBOX_RECIPIENT_MAP"
		class="com.intellectdesign.canvas.alert.inbox.InboxMessageRecipient">
		<result property="gcif" nullValue="" column="OD_GCIF" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="userId" nullValue="" column="OD_USER_NO"
			javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EXT_GET_RECIPIENT_DTLS"
		parameterClass="java.util.HashMap" resultMap="INBOX_RECIPIENT_MAP">
		SELECT
		OD_GCIF,
		OD_USER_NO
		FROM
		OD_USERS_MB
		WHERE
		OD_USER_NO IN
		<iterate property="USER_ID" open="(" close=")" conjunction=",">
			#USER_ID[]#
		</iterate>
	</select>


	<!-- This query is used to update the severity handled indicator status 
		for the given message ids -->
	<update id="ALERT_FRMWRK_MNT_UPDATE_ALERT_EXT_SET_USER_ACCESS_TIME"
		parameterClass="java.util.HashMap">
		UPDATE
		USER_NEW_MSG_TRACKER
		SET
		MSG_ACCESSED_TS=SYSDATE()
		WHERE
		USER_NO=#__FILTER__USER_ID#
	</update>

	<!-- Delete from User new message table -->
	<delete id="ALERT_FRMWRK_MNT_DELETE_ALERT_EXT_NEW_MSG_TRACKER_RECORDS"
		parameterClass="java.util.HashMap">
		DELETE FROM
		USER_NEW_MSG_TRACKER
		WHERE
		USER_NO IN
		<iterate property="USER_ID" open="(" close=")" conjunction=",">
			#USER_ID[]#
		</iterate>
	</delete>

	<!-- Parameter map for inserting details in user_new_message_table -->
	<parameterMap id="USER_NEW_MSG_PARAM_MAP" class="java.util.HashMap">
		<parameter property="USER_ID" jdbcType="VARCHAR" javaType="java.lang.String" />
	</parameterMap>

	<!-- inbox recipient insertion into master -->
	<insert id="ALERT_FRMWRK_MNT_INSERT_ALERT_EXT_NEW_MSG_TRACKER"
		parameterMap="USER_NEW_MSG_PARAM_MAP">
		INSERT INTO USER_NEW_MSG_TRACKER
		(
		USER_NO,
		NEW_MSG_RECIEVED_TS
		)
		VALUES
		(
		?,
		SYSDATE()
		)
	</insert>

	<!-- inbox recipient batch insertion into master -->
	<insert id="ALERT_FRMWRK_MNT_BATCH_INSERT_ALERT_EXT_NEW_MSG_TRACKER"
		parameterMap="USER_NEW_MSG_PARAM_MAP">
		INSERT INTO USER_NEW_MSG_TRACKER
		(
		USER_NO,
		NEW_MSG_RECIEVED_TS
		)
		VALUES
		(
		?,
		SYSDATE()
		)
	</insert>


	<resultMap
		id="GET_UNREAD_URGENT_NORMAL_ALERT_NOTIFICATION_COUNTS_RESULTMAP"
		class="java.util.HashMap">
		<result property="NUM_ALERTS" nullValue="" column="NUM_ALERTS"
			javaType="java.lang.Integer" jdbcType="NUMBER" />
	</resultMap>

	<select
		id="ALERT_FRMWRK_MNT_SELECT_GET_UNREAD_URGENT_NORMAL_ALERT_NOTIFICATION_COUNTS"
		parameterClass="java.util.HashMap"
		resultMap="GET_UNREAD_URGENT_NORMAL_ALERT_NOTIFICATION_COUNTS_RESULTMAP">

		SELECT COUNT(MESSAGE_ID) AS NUM_ALERTS
		FROM OD_USER_MESSAGE
		WHERE TO_USER_ID = #USER_ID#
		AND READ_INDICATOR ='N'
		AND DELETED ='N'
		<!-- SELECT AMSTR.SEVERITY SEVERITY, COUNT(DECODE(AMSTR.IS_NOTIFICATION,'N',1,NULL)) 
			NUM_ALERTS, COUNT(DECODE(AMSTR.IS_NOTIFICATION,'Y',1,NULL)) NUM_NOTIFICATION 
			FROM OD_MESSAGE MSG, OD_USER_MESSAGE UMSG, ALERT_MASTER AMSTR, EVENT_MASTER 
			EMSTR WHERE MSG.MESSAGE_TS BETWEEN SYSDATE()-31 AND SYSDATE() AND (UMSG.TO_USER_ID 
			=#USER_ID# OR UMSG.TO_USER_ID ='ALL_USERS') AND UMSG.GCIF = #GCIF# AND READ_INDICATOR 
			= 'N' AND MSG.MESSAGE_ID = UMSG.MESSAGE_ID AND AMSTR.ALERT_ID = MSG.ALERT_ID 
			AND EMSTR.EVENT_ID = AMSTR.EVENT_ID AND UMSG.DELETED = 'N' AND MSG.ARCHIVED_INDICATOR 
			= 'N' GROUP BY AMSTR.SEVERITY -->
	</select>

	<resultMap id="SMTP_RECIPIENT_MAP" class="com.intellectdesign.canvas.alert.smtp.SmtpMessageRecipient">
		<result property="gcif" nullValue="" column="OD_GCIF" javaType="java.lang.String" jdbcType="VARCHAR"/>
		<result property="userId" nullValue="" column="OD_USER_NO" javaType="java.lang.String" jdbcType="VARCHAR"/>
		<result property="emailId" nullValue="" column="EMAIL_ID" javaType="java.lang.String" jdbcType="VARCHAR"/>
	</resultMap>
	

	<select id="ALERT_FRMWRK_MNT_SELECT_ALERT_EMAIL_GET_RECIPIENT_DTLS" parameterClass ="java.util.HashMap" resultMap="SMTP_RECIPIENT_MAP">
	SELECT 
		OD_GCIF,
		OD_USER_NO,
		EMAIL_ID 
	FROM 
		OD_USERS_MB
	WHERE
		OD_USER_NO  IN 
		<iterate property="USER_ID" open="(" close=")" conjunction=",">
			#USER_ID[]#
		</iterate>
	</select>


	<resultMap id="MESSAGES_MAP" class="java.util.HashMap">
		<result property="ALERT_ID" nullValue="" column="ALERT_ID" javaType="java.lang.String" jdbcType="NUMBER"/>
		<result property="EVENT_ID" nullValue="" column="EVENT_ID" javaType="java.lang.String" jdbcType="NUMBER"/>
		<result property="CHANNEL_ID" nullValue="" column="CHANNEL_ID" javaType="java.lang.String" jdbcType="NUMBER"/>
	</resultMap>

	<select id="ALERT_FRMWRK_MNT_SELECT_GET_EVENT_ID" parameterClass ="java.util.HashMap" resultMap="MESSAGES_MAP">
		SELECT 
			A.ALERT_ID, 
			A.EVENT_ID, 
			C.CHANNEL_ID
		FROM 
			ALERT_MASTER A,
		        OD_ALERT_CHANNEL_DETAILS C
		WHERE 
			EVENT_ID IN (
				SELECT E.EVENT_ID FROM EVENT_MASTER E
				WHERE E.ACTION =#TRANS_CODE#
			)
		AND 
		        C.ALERT_ID = A.ALERT_ID
	</select>

	<resultMap id="ALERT_ENRICH_DATA_FETCH_TEMPLATE_RESULT_MAP" class="java.util.HashMap">
		<result property="CHANNEL_ID" nullValue="" column="CHANNEL_ID" javaType="java.lang.String" jdbcType="VARCHAR"/>
		<result property="EMAIL_TEMPLATE_CODE" nullValue="" column="EMAIL_TEMPLATE_CODE" javaType="java.lang.String" jdbcType="VARCHAR"/>
		<result property="CHANNEL_NAME" nullValue="" column="CHANNEL_NAME" javaType="java.lang.String" jdbcType="VARCHAR"/>
	</resultMap>
	
	<!-- This query fetches the email template code -->
	<select id="ALERT_ENRICH_DATA_FETCH_SELECT_ALERT_TEMPLATE_CODE" parameterClass ="java.util.HashMap" resultMap="ALERT_ENRICH_DATA_FETCH_TEMPLATE_RESULT_MAP">
		SELECT
			OACD.CHANNEL_ID CHANNEL_ID,
			OACD.ALERT_TEMPLATE_CODE EMAIL_TEMPLATE_CODE,
			CM.CHANNEL_NAME CHANNEL_NAME
		FROM 
			OD_ALERT_CHANNEL_DETAILS OACD,
			CHANNEL_MASTER CM
		WHERE
			OACD.CHANNEL_ID = CM.CHANNEL_ID
		AND
			OACD.ALERT_ID = #ALERT_ID#
	</select>
<update id="ALERT_FRMWRK_MNT_UPDATE_ALERT_EXT_UPDATE_MSG_STATUS" parameterClass="java.util.HashMap">
		UPDATE 
			OD_USER_MESSAGE 
		SET 
			DELETED=#__FILTER__STATUS#
		WHERE
			TO_USER_ID=#__FILTER__USER_ID# 
		AND
			GCIF = #__FILTER__GCIF# 
		AND 
			MESSAGE_ID IN 
		<iterate property="__FILTER__MESSAGE_ID" open="(" close=")" conjunction=",">
			#__FILTER__MESSAGE_ID[]#
		</iterate>
	</update>

	<update id="ALERT_FRMWRK_MNT_UPDATE_ALERT_EXT_MARK_MSGS_AS_READ" parameterClass="java.util.HashMap">
		UPDATE 
			OD_USER_MESSAGE 
		SET 
			READ_INDICATOR='Y'
		WHERE
			TO_USER_ID=#__FILTER__USER_ID# 
		AND
			GCIF = #__FILTER__GCIF# 
		AND 
		MESSAGE_ID IN 
		<iterate property="__FILTER__MESSAGE_ID" open="(" close=")" conjunction=",">
			#__FILTER__MESSAGE_ID[]#
		</iterate>
	</update>


</sqlMap>